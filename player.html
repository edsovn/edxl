<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Player</title>
<script type="text/javascript" charset="utf-8" async="" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
<script type="text/javascript" charset="utf-8" async="" src="//ssl.p.jwpcdn.com/player/plugins/related/v/6.2.4/related.js"></script>
<script type="text/javascript" charset="utf-8" async="" src="//ssl.p.jwpcdn.com/player/v/8.36.4/jwpsrv.js"></script>
<script type="text/javascript" src="//ssl.p.jwpcdn.com/player/v/8.36.4/jwplayer.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer" type="text/javascript"></script>
<script type="text/javascript">
    jwplayer.key = 'XsK+VuloUK5YB+O7Z6I3aD4DP42TKEoQd2MLvA=='
    // jwplayer.key = 'eNFaXCjyURVoCCGiHp7HTQ3hDhE/AfL0g8VE1fRbL84=';
    // jwplayer.key = 'ypdL3Acgwp4Uh2/LDE9dYh3W/EPwDMuA2yid4ytssfI=';
    // jwplayer.key = 'ITWMv7t88JGzI0xPwW8I0+LveiXX9SWbfdmt0ArUSyc=';
    // jwplayer.key = '64HPbvSQorQcd52B8XFuhMtEoitbvY/EXJmMBfKcXZQU2Rnn';
</script>
<script charset="utf-8" src="//ssl.p.jwpcdn.com/player/v/8.36.4/jwplayer.core.controls.html5.js"></script>
<script charset="utf-8" src="//ssl.p.jwpcdn.com/player/v/8.36.4/provider.cast.js"></script>
<script src="//www.gstatic.com/cast/sdk/libs/sender/1.0/cast_framework.js"></script>
<script src="//www.gstatic.com/eureka/clank/134/cast_sender.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #000;
    overflow: hidden;
  }

    .jw-reset .jw-button-container div.jw-icon-rewind {
      display: none;
    }

  #player {
    width: 100%;
    height: 100%;
    min-height: 360px;
    position: relative;
  }

  #continue-box {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    display: none;
    justify-content: center;
    align-items: center;
  }

  #continue-box.active {
    display: flex;
    pointer-events: auto;
  }

  ._4continuar {
    color: #fff;
    padding: 20px;
    max-width: 90%;
    text-align: center;
    border-radius: 8px;
    background: rgba(41, 41, 41, 0.95);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  }

  ._4continuar .bt {
    padding: 10px 20px;
    background: #383838;
    display: inline-block;
    margin: 10px 5px 0;
    border-radius: 4px;
    cursor: pointer;
    color: white;
    font-weight: bold;
  }

  ._4continuar .bt:hover {
    background: #504f4f;
  }
</style>
</head>
<body>

<div id="continue-box"></div>
<div id="player">Carregando o player...</div>

<div id="player" style="width:100%;height:100%;"></div>

<script>
function getVideoURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("video");
}

function millisToMinutesAndSeconds(time) {
  const min = Math.floor(time / 60);
  const sec = Math.floor(time % 60).toString().padStart(2, "0");
  return `${min}:${sec}`;
}

document.addEventListener("DOMContentLoaded", function () {
  const playerId = "player";
  const file = getVideoURL();
  if (!file) return;

  const uniqueID = "w" + playerId;
  const storageKey = "jw_" + uniqueID;
  const currentPosition = parseFloat(localStorage.getItem(storageKey));
  let lock = false;

  jwplayer(playerId).setup({
    file: file,
    width: '100%',
    height: '100%',
    localization: {
      fullscreen: "Tela Cheia",
      hd: "Qualidade",
      copied: "Copiado",
      playbackRates: "Velocidade da reprodu√ß√£o",
      videoInfo: "Sobre este v√≠deo",
      rewind: "Voltar 10s",
      forward: "Avan√ßar 10s",
      settings: "Configura√ß√µes",
      loadingAd: "Carregando an√∫ncio",
    },
    controls: true,
    displaytitle: true,
    aboutlink: 'https://webmods.com.br/',
    playbackRateControls: "[0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]",
    plugins: {
      snapshot: {}
    },
    volume: "100",
    preload: "none",
    repeat: "false",
    autostart: true
  });

  // üîÅ Retomada
  jwplayer(playerId).on('play', function () {
    if (!lock && currentPosition && currentPosition > 0) {
      jwplayer(playerId).pause();
      const boxId = "_4continuar_" + playerId;
      const boxHtml = `
        <div class="_4continuar" id="${boxId}">
          <p>Aparentemente voc√™ j√° esteve assistindo isto, e voc√™ parou em ${millisToMinutesAndSeconds(currentPosition)}. Deseja continuar de onde parou?</p>
          <bt data-time="${currentPosition}">Sim</bt><bt data-time="0">N√£o</bt>
        </div>`;
      document.getElementById(playerId).insertAdjacentHTML("beforeend", boxHtml);

      document.querySelectorAll(`#${boxId} > bt`).forEach(function (bt) {
        bt.addEventListener("click", function () {
          const startIn = parseFloat(this.getAttribute("data-time"));
          document.getElementById(boxId).remove();
          jwplayer(playerId).seek(startIn);
          jwplayer(playerId).play();
        });
      });
    }
    lock = true;

    (function ping() {
      localStorage.setItem(storageKey, jwplayer(playerId).getPosition());
      setTimeout(ping, 1000);
    })();
  });

  // Move bot√µes para a esquerda
  jwplayer(playerId).on("beforePlay", function () {
    function tryMoveButtons(attempts = 10) {
      const player = jwplayer(playerId);
      const container = player.getContainer().querySelector(".jw-button-container");
      const rewind = player.getContainer().querySelector("[button='rewind']");
      const forward = player.getContainer().querySelector("[button='forward']");
      const skip = player.getContainer().querySelector("[button='pula-opening']");

      if (container && rewind && forward && skip && container.children.length) {
        const buttons = container.children;
        const playButton = buttons[0];
        if (playButton) {
          container.insertBefore(rewind, playButton.nextSibling);
          container.insertBefore(forward, rewind.nextSibling);
          container.insertBefore(skip, forward.nextSibling);
        }
      } else if (attempts > 0) {
        setTimeout(() => tryMoveButtons(attempts - 1), 100);
      }
    }

    tryMoveButtons();
  });

  // Bot√£o de download
  jwplayer(playerId).addButton(
    '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21"><path fill="#f5f5f5" d="M18.625 20.977H1.418A1.42 1.42 0 0 1 0 19.594V14a1.42 1.42 0 0 1 1.418-1.383c.793 0 1.414.605 1.414 1.383v4.191h14.313V14a1.42 1.42 0 0 1 1.418-1.383c.793 0 1.418.605 1.418 1.383v5.594c.063.778-.559 1.383-1.457 1.383zM10.902 12.953a.996.996 0 0 1-1.805 0l-4.46-4.004a1 1 0 1 1 1.361-1.473l2.125 1.906V1.406A1.383 1.383 0 0 1 9.98 0a1.383 1.383 0 0 1 1.414 1.406v7.836l2.125-1.906a1 1 0 1 1 1.36 1.473z"/></svg>',
    "Baixar",
    function () {
      let downloadUrl = file;
      if (/\.mp4$/i.test(downloadUrl)) {
        downloadUrl += "?dl=1";
      }
      downloadUrl = downloadUrl.replace(/&raw=1$/, '&dl=1');
      window.location.href = downloadUrl;
    },
    "download"
  );

  // Bot√£o pular OP
  jwplayer(playerId).addButton("https://www.anitube.vip/img/skip.svg?version=0.0.1", "Pular OP/ED", function () {
    jwplayer(playerId).seek(jwplayer(playerId).getPosition() + 83);
  }, "pula-opening");

  // Bot√µes de avan√ßar/retroceder
  jwplayer(playerId).addButton('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240"><path d="..."/></svg>', 'Avan√ßar 10s', function() {
    const time = jwplayer(playerId).getPosition() + 10;
    jwplayer(playerId).seek(time <= 0 ? 0 : time);
  }, 'forward');

  jwplayer(playerId).addButton('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240"><path d="..."/></svg>', 'Voltar 10s', function() {
    const time = jwplayer(playerId).getPosition() - 10;
    jwplayer(playerId).seek(time <= 0 ? 0 : time);
  }, 'rewind');

  // Autoplay em fullscreen e orienta√ß√£o
  window.addEventListener("message", function (e) {
    if (e.data == 'autoplay') {
      const vid = document.getElementsByTagName("video")[0];
      if (vid.requestFullscreen) vid.requestFullscreen();
      jwplayer(playerId).play();
    }
  });

  window.onorientationchange = function () {
    if (screen.orientation.type.startsWith('landscape')) {
      const vid = document.getElementsByTagName("video")[0];
      if (vid.requestFullscreen) vid.requestFullscreen();
    }
  };
});
</script>
</body>
</html>
