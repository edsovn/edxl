<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Player</title>
<script src="https://ssl.p.jwpcdn.com/player/v/8.36.4/jwplayer.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #000;
    overflow: hidden;
  }

  #player {
    width: 100%;
    height: 100%;
    min-height: 360px;
    position: relative;
  }

  #continue-box {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    display: none;
    justify-content: center;
    align-items: center;
  }

  #continue-box.active {
    display: flex;
    pointer-events: auto;
  }

  ._4continuar {
    color: #fff;
    padding: 20px;
    max-width: 90%;
    text-align: center;
    border-radius: 8px;
    background: rgba(41, 41, 41, 0.95);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  }

  ._4continuar .bt {
    padding: 10px 20px;
    background: #383838;
    display: inline-block;
    margin: 10px 5px 0;
    border-radius: 4px;
    cursor: pointer;
    color: white;
    font-weight: bold;
  }

  ._4continuar .bt:hover {
    background: #504f4f;
  }

  #custom-controls {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    display: flex;
    gap: 1rem;
    z-index: 9999;
    flex-wrap: wrap;
    align-items: center;
  }

  .icon-btn {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .icon-btn svg {
    width: 6vw;
    height: 6vw;
    min-width: 32px;
    min-height: 32px;
    max-width: 56px;
    max-height: 56px;
    fill: #fff;
    cursor: pointer;
    transition: fill 0.3s ease;
  }

  .icon-btn svg:hover {
    fill: #aaa;
  }

  @media (max-width: 600px) {
    .icon-btn svg {
      width: 8vw;
      height: 8vw;
      min-width: 28px;
      min-height: 28px;
    }
  }
</style>
</head>
<body>

<div id="continue-box"></div>
<div id="player">Carregando o player...</div>
<div id="custom-controls">
  <div id="rewind10" class="icon-btn"></div>
  <div id="forward10" class="icon-btn"></div>
  <div id="download" class="icon-btn"></div>
</div>

<script>
  jwplayer.key = 'XsK+VuloUK5YB+O7Z6I3aD4DP42TKEoQd2MLvA==';

  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  const VIDEO_URL = getQueryParam("video");
  const DOWNLOAD_URL = VIDEO_URL ? VIDEO_URL.replace("raw=1", "dl=1") : "";

  if (!VIDEO_URL) {
    document.getElementById("player").innerHTML = '<p style="color:white;padding:20px">URL do vídeo não fornecida.</p>';
  } else {
    function extractUniqueId(url) {
      try {
        const path = new URL(url).pathname;
        const parts = path.split('/');
        const sclIndex = parts.indexOf('scl');
        const sIndex = parts.indexOf('s');

        if (sclIndex !== -1 && parts[sclIndex + 2]) {
          return parts[sclIndex + 2];
        } else if (sIndex !== -1 && parts[sIndex + 1]) {
          return parts[sIndex + 1];
        }
        return url;
      } catch (e) {
        return url;
      }
    }

    const UNIQUE_ID = extractUniqueId(VIDEO_URL);
    const ID = 'video_' + UNIQUE_ID;
    let currentPosition = parseFloat(localStorage.getItem(ID)) || 0;
    let volume = 100;

    function millisToMinutesAndSeconds(seconds) {
      const min = Math.floor(seconds / 60);
      const sec = Math.floor(seconds % 60);
      return `${min}:${sec < 10 ? '0' : ''}${sec}`;
    }

    jwplayer("player").setup({
      file: VIDEO_URL,
      width: "100%",
      height: "100%",
      controls: true,
      autostart: false,
      playbackRateControls: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2],
      displaytitle: true,
      preload: "none",
      repeat: false,
      volume: volume,
      localization: {
        rewind: "Voltar 10s",
        forward: "Avançar 10s",
        fullscreen: "Tela Cheia",
        hd: "Qualidade"
      }
    });

    jwplayer("player").on('ready', function () {
      jwplayer("player").setPlaybackRate(1);

      setTimeout(() => {
        document.getElementById("rewind10").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="jw-svg-icon jw-svg-icon-rewind" viewBox="0 0 240 240"><path d="M113.2,131.078a21.589,21.589,0,0,0-17.7-10.6,21.589,21.589,0,0,0-17.7,10.6,44.769,44.769,0,0,0,0,46.3,21.589,21.589,0,0,0,17.7,10.6,21.589,21.589,0,0,0,17.7-10.6,44.769,44.769,0,0,0,0-46.3Z"/></svg>';
        document.getElementById("forward10").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="jw-svg-icon jw-svg-icon-forward" viewBox="0 0 240 240"><path d="M126.8,131.078a21.589,21.589,0,0,1,17.7-10.6,21.589,21.589,0,0,1,17.7,10.6,44.769,44.769,0,0,1,0,46.3,21.589,21.589,0,0,1-17.7,10.6,21.589,21.589,0,0,1-17.7-10.6,44.769,44.769,0,0,1,0-46.3Z"/></svg>';
        document.getElementById("download").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20px" height="21px" viewBox="0 0 20 21"><path d="M10.9 12.95c-.5.44-1.3.44-1.8 0L4.64 8.95a1 1 0 1 1 1.4-1.6L8.56 9.26V1.41a1 1 0 0 1 2 0v7.83l2.13-1.9a1 1 0 1 1 1.32 1.5zM18.63 21H1.42A1.43 1.43 0 0 1 0 19.59V14a1.43 1.43 0 0 1 2.83 0v4.19h14.31V14a1.43 1.43 0 0 1 2.85 0v5.59c.06.78-.56 1.41-1.36 1.41z"/></svg>';

        document.getElementById("rewind10").onclick = () => {
          const time = jwplayer("player").getPosition() - 10;
          jwplayer("player").seek(time > 0 ? time : 0);
        };
        document.getElementById("forward10").onclick = () => jwplayer("player").seek(jwplayer("player").getPosition() + 10);
        document.getElementById("download").onclick = () => {
          const link = document.createElement("a");
          link.href = DOWNLOAD_URL;
          link.download = "";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        };
      }, 500);
    });

    jwplayer("player").on('firstFrame', function () {
      if (currentPosition && currentPosition > 0) {
        jwplayer("player").pause();
        const box = `
          <div class="_4continuar">
            <p>Aparentemente você já esteve assistindo isto, e você parou em ${millisToMinutesAndSeconds(currentPosition)}. Deseja continuar de onde parou?</p>
            <button class="bt" data-time="${currentPosition}">Sim</button>
            <button class="bt" data-time="0">Não</button>
          </div>`;
        $("#continue-box").html(box).addClass("active");
      }
    });

    $(document).on('click', '._4continuar .bt', function () {
      const time = parseFloat($(this).data("time"));
      $("#continue-box").removeClass("active").empty();
      jwplayer("player").seek(time);
      jwplayer("player").play();
    });

    jwplayer("player").on('time', function () {
      const pos = jwplayer("player").getPosition();
      if (!isNaN(pos)) {
        localStorage.setItem(ID, pos);
      }
    });

    window.addEventListener("message", function (e) {
      if (e.data === 'autoplay') {
        jwplayer("player").play();
      }
    });
  }
</script>
</body>
</html>
