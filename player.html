<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player</title>
<script src="https://ssl.p.jwpcdn.com/player/v/8.36.4/jwplayer.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #000;
  }
  #player {
    width: 100%;
    height: 100%;
    min-height: 360px;
  }
  ._4continuar {
    color: #fff;
    min-height: 6em;
    padding: 18px;
    margin: 10px;
    width: 100%;
    text-align: left;
    border-radius: 4px;
    background: #292929;
  }
  ._4continuar .bt {
    padding: 10px;
    background: #383838;
    display: inline-block;
    margin: 5px;
    border-radius: 4px;
    cursor: pointer;
  }
  ._4continuar .bt:hover {
    background: #504f4f;
  }
</style>
<script>
  jwplayer.key = 'XsK+VuloUK5YB+O7Z6I3aD4DP42TKEoQd2MLvA==';

  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  const VIDEO_URL = getQueryParam("video");
  const DOWNLOAD_URL = VIDEO_URL ? VIDEO_URL.replace("raw=1", "dl=1") : "";
</script>
</head>
<body>
<div id="player">Carregando o player...</div>
<script>
  if (!VIDEO_URL) {
    document.getElementById("player").innerHTML = '<p style="color:white;padding:20px">URL do vídeo não fornecida.</p>';
  } else {
    jwplayer("player").setup({
      file: VIDEO_URL,
      width: "100%",
      height: "100%",
      controls: true,
      autostart: false,
      playbackRateControls: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2],
      displaytitle: true,
      preload: "none",
      repeat: false,
      volume: 100,
      localization: {
        rewind: "Voltar 10s",
        forward: "Avançar 10s",
        fullscreen: "Tela Cheia",
        hd: "Qualidade"
      }
    });

    jwplayer("player").addButton(
      "https://www.anitube.vip/img/skip.svg?version=0.0.1",
      "Pular OP/ED",
      function () {
        jwplayer("player").seek(jwplayer("player").getPosition() + 82);
      },
      "skip"
    );

    jwplayer("player").addButton(
      "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 240 240'><path d='M113.2...'/></svg>",
      "Avançar 10s",
      function () {
        const time = jwplayer("player").getPosition() + 10;
        jwplayer("player").seek(time);
      },
      "forward"
    );

    jwplayer("player").addButton(
      "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 240 240'><path d='M113.2...'/></svg>",
      "Voltar 10s",
      function () {
        const time = jwplayer("player").getPosition() - 10;
        jwplayer("player").seek(time < 0 ? 0 : time);
      },
      "rewind"
    );

    jwplayer("player").addButton(
      "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 21'><path d='M 18.625 ...'/></svg>",
      "Baixar",
      function () {
        window.location.href = DOWNLOAD_URL;
      },
      "download"
    );

    (function () {
      const ID = 'videoUrl';
      let lock = false;
      let currentPosition = localStorage.getItem("w" + ID);

      jwplayer("player").on('play', function () {
        if (!lock && currentPosition > 0) {
          jwplayer("player").pause();
          const box = `
            <div class="_4continuar">
              <p>Você parou em ${millisToMinutesAndSeconds(currentPosition)}. Deseja continuar?</p>
              <button class="bt" data-time="${currentPosition}">Sim</button>
              <button class="bt" data-time="0">Não</button>
            </div>`;
          $("#player").append(box);
        }
        lock = true;
      });

      $(document).on('click', '._4continuar .bt', function () {
        const time = $(this).data("time");
        $("._4continuar").remove();
        jwplayer("player").seek(time);
      });

      jwplayer("player").on('time', function () {
        localStorage.setItem("w" + ID, jwplayer("player").getPosition());
      });

      function millisToMinutesAndSeconds(time) {
        const min = Math.floor(time / 60);
        const sec = ("0" + Math.floor(time % 60)).slice(-2);
        return `${min}:${sec}`;
      }
    })();

    window.addEventListener("message", function (e) {
      if (e.data === 'autoplay') {
        jwplayer("player").play();
      }
    });
  }
</script>
</body>
</html>
