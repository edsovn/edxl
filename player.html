<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player</title>
<script src="https://ssl.p.jwpcdn.com/player/v/8.36.4/jwplayer.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #000;
    overflow: hidden;
  }

  #player {
    width: 100%;
    height: 100%;
    min-height: 360px;
    position: relative;
  }
  
    .icon-btn svg {
      width: 48px;
      height: 48px;
      fill: #fff;
      cursor: pointer;
      transition: fill 0.3s ease;
    }
    .icon-btn svg:hover {
      fill: #aaa;
    }

  #continue-box {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    display: none;
    justify-content: center;
    align-items: center;
  }

  #continue-box.active {
    display: flex;
    pointer-events: auto;
  }

  ._4continuar {
    color: #fff;
    padding: 20px;
    max-width: 90%;
    text-align: center;
    border-radius: 8px;
    background: rgba(41, 41, 41, 0.95);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  }

  ._4continuar .bt {
    padding: 10px 20px;
    background: #383838;
    display: inline-block;
    margin: 10px 5px 0;
    border-radius: 4px;
    cursor: pointer;
    color: white;
    font-weight: bold;
  }

  ._4continuar .bt:hover {
    background: #504f4f;
  }

  #gesture-left, #gesture-right {
    position: absolute;
    top: 0;
    width: 20%;
    height: 100%;
    z-index: 9998;
    touch-action: none;
    display: none;
  }

  #gesture-left { left: 0; }
  #gesture-right { right: 0; }

  #brightness-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: black;
    pointer-events: none;
    opacity: 0;
    z-index: 9997;
  }

  #hud-feedback {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(30, 30, 30, 0.85);
    padding: 12px 20px;
    border-radius: 10px;
    color: white;
    font-size: 16px;
    display: none;
    flex-direction: column;
    align-items: center;
    z-index: 99999;
  }

  #hud-feedback img {
    width: 32px;
    height: 32px;
    margin-bottom: 5px;
  }
</style>
</head>
<body>

<div id="continue-box"></div>
<div id="player">Carregando o player...</div>
<div id="fastForward" class="icon-btn"></div>
<div id="rewind10" class="icon-btn"></div>
<div id="forward10" class="icon-btn"></div>
<div id="download" class="icon-btn"></div>
<div id="brightness-overlay"></div>
<div id="gesture-left"></div>
<div id="gesture-right"></div>

<!-- HUD visual -->
<div id="hud-feedback">
  <img id="hud-icon" src="" alt="icone">
  <div id="hud-text"></div>
</div>

<script>
  jwplayer.key = 'XsK+VuloUK5YB+O7Z6I3aD4DP42TKEoQd2MLvA==';

  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  const VIDEO_URL = getQueryParam("video");
  const DOWNLOAD_URL = VIDEO_URL ? VIDEO_URL.replace("raw=1", "dl=1") : "";

  if (!VIDEO_URL) {
    document.getElementById("player").innerHTML = '<p style="color:white;padding:20px">URL do vídeo não fornecida.</p>';
  } else {
    const videoName = new URL(VIDEO_URL).pathname.split('/').pop();
    const ID = 'video_' + videoName;
    let currentPosition = parseFloat(localStorage.getItem(ID));
    let volume = 100;
    let brightness = 0;
    let isFullscreen = false;
    let startY = 0;
    let isLeft = false;
    let hudTimeout;

    function clamp(val, min, max) {
      return Math.max(min, Math.min(max, val));
    }

    function millisToMinutesAndSeconds(time) {
      const min = Math.floor(time / 60);
      const sec = ("0" + Math.floor(time % 60)).slice(-2);
      return `${min}:${sec}`;
    }

    function showHUD(type, value) {
      if (!isFullscreen) return;

      const hud = document.getElementById('hud-feedback');
      const icon = document.getElementById('hud-icon');
      const text = document.getElementById('hud-text');

      if (type === 'volume') {
        icon.src = "https://cdn-icons-png.flaticon.com/512/727/727240.png";
        text.textContent = `Volume: ${Math.round(value)}%`;
      } else if (type === 'brilho') {
        icon.src = "https://cdn-icons-png.flaticon.com/512/3103/3103446.png";
        text.textContent = `Brilho: ${Math.round(value * 100)}%`;
      }

      hud.style.display = 'flex';
      clearTimeout(hudTimeout);
      hudTimeout = setTimeout(() => {
        hud.style.display = 'none';
      }, 1500);
    }

    function handleStart(e, side) {
      if (!isFullscreen) return;
      startY = e.touches[0].clientY;
      isLeft = (side === 'left');
    }

    function handleMove(e) {
      if (!isFullscreen) return;
      const deltaY = startY - e.touches[0].clientY;
      const change = deltaY / window.innerHeight * 100;

      if (!isLeft) {
        volume = clamp(volume + change, 0, 100);
        jwplayer().setVolume(volume);
        showHUD('volume', volume);
      } else {
        brightness = clamp(brightness - (change / 150), 0, 0.8);
        document.getElementById('brightness-overlay').style.opacity = brightness;
        showHUD('brilho', brightness);
      }

      startY = e.touches[0].clientY;
    }

    jwplayer("player").setup({
      file: VIDEO_URL,
      width: "100%",
      height: "100%",
      controls: true,
      autostart: false,
      playbackRateControls: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2],
      displaytitle: true,
      preload: "none",
      repeat: false,
      volume: volume,
      localization: {
        rewind: "Voltar 10s",
        forward: "Avançar 10s",
        fullscreen: "Tela Cheia",
        hd: "Qualidade"
      }
    });

    jwplayer("player").on('ready', function () {
      jwplayer("player").setPlaybackRate(1);

      setTimeout(() => {
        jwplayer("player").addButton(
          "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M4 4v16l7-8zm9 0v16l7-8z'/></svg>",
          "Pular OP/ED",
          () => jwplayer("player").seek(jwplayer("player").getPosition() + 82),
          "skip"
        );
        jwplayer("player").addButton(
          "https://www.svgrepo.com/show/511360/rewind-10-seconds.svg",
          "Avançar 10s",
          () => jwplayer("player").seek(jwplayer("player").getPosition() + 10),
          "forward"
        );
        jwplayer("player").addButton(
          "https://www.svgrepo.com/download/495319/forward-10-seconds.svg",
          "Voltar 10s",
          () => {
            const time = jwplayer("player").getPosition() - 10;
            jwplayer("player").seek(time > 0 ? time : 0);
          },
          "rewind"
        );
        jwplayer("player").addButton(
          "https://www.svgrepo.com/show/486992/download.svg",
          "Baixar",
          () => window.open(DOWNLOAD_URL, "_blank"),
          "download"
        );
      }, 500);
    });

    jwplayer("player").on('firstFrame', function () {
      if (currentPosition && currentPosition > 0) {
        jwplayer("player").pause();
        const box = `
          <div class="_4continuar">
            <p>Aparentemente você ja esteve assistindo isto, e você parou em ${millisToMinutesAndSeconds(currentPosition)}. Deseja continuar de onde parou?</p>
            <button class="bt" data-time="${currentPosition}">Sim</button>
            <button class="bt" data-time="0">Não</button>
          </div>`;
        $("#continue-box").html(box).addClass("active");
      }
    });

    $(document).on('click', '._4continuar .bt', function () {
      const time = parseFloat($(this).data("time"));
      $("#continue-box").removeClass("active").empty();
      jwplayer("player").seek(time);
      jwplayer("player").play();
    });

    jwplayer("player").on('time', function () {
      const pos = jwplayer("player").getPosition();
      if (!isNaN(pos)) {
        localStorage.setItem(ID, pos);
      }
    });

    window.addEventListener("message", function (e) {
      if (e.data === 'autoplay') {
        jwplayer("player").play();
      }
    });

    document.getElementById('gesture-left').addEventListener('touchstart', e => handleStart(e, 'left'));
    document.getElementById('gesture-left').addEventListener('touchmove', handleMove);
    document.getElementById('gesture-right').addEventListener('touchstart', e => handleStart(e, 'right'));
    document.getElementById('gesture-right').addEventListener('touchmove', handleMove);

    jwplayer("player").on('fullscreen', function (e) {
      isFullscreen = e.fullscreen;
      document.getElementById('gesture-left').style.display = isFullscreen ? 'block' : 'none';
      document.getElementById('gesture-right').style.display = isFullscreen ? 'block' : 'none';
      if (!isFullscreen) {
        document.getElementById('hud-feedback').style.display = 'none';
      }
    });
  }
</script>
</body>
</html>
