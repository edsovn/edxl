<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player</title>
  <script src="https://ssl.p.jwpcdn.com/player/v/8.36.4/jwplayer.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
    }

    #player {
      width: 100%;
      height: 100%;
      min-height: 360px;
      position: relative;
    }

    .jw-reset .jw-button-container div.jw-icon-rewind {
      display: none;
    }

    .icon-btn svg {
      width: 48px;
      height: 48px;
      fill: #fff;
      cursor: pointer;
      transition: fill 0.3s ease;
    }
    .icon-btn svg:hover {
      fill: #aaa;
    }

    #continue-box {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
    }

    #continue-box.active {
      display: flex;
      pointer-events: auto;
    }

    ._4continuar {
      color: #fff;
      padding: 20px;
      max-width: 90%;
      text-align: center;
      border-radius: 8px;
      background: rgba(41, 41, 41, 0.95);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      font-weight: bold;
    }

    ._4continuar .bt {
      padding: 10px 20px;
      background: #383838;
      display: inline-block;
      margin: 10px 5px 0;
      border-radius: 4px;
      cursor: pointer;
      color: white;
      font-weight: bold;
    }

    ._4continuar .bt:hover {
      background: #504f4f;
    }
  </style>
</head>
<body>

<div id="continue-box"></div>
<div id="player">Carregando o player...</div>

<script>
  jwplayer.key = 'XsK+VuloUK5YB+O7Z6I3aD4DP42TKEoQd2MLvA==';

  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  const VIDEO_URL = getQueryParam("video");
  const DOWNLOAD_URL = VIDEO_URL ? VIDEO_URL.replace("raw=1", "dl=1") : "";

  if (!VIDEO_URL) {
    document.getElementById("player").innerHTML = '<p style="color:white;padding:20px">URL do vídeo não fornecida.</p>';
  } else {
    const videoName = new URL(VIDEO_URL).pathname.split('/').pop();
    const ID = 'video_' + videoName;
    let currentPosition = parseFloat(localStorage.getItem(ID)) || 0;
    let volume = 100;

    jwplayer("player").setup({
      file: VIDEO_URL,
      width: "100%",
      height: "100%",
      controls: true,
      autostart: false,
      playbackRateControls: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2],
      displaytitle: true,
      preload: "none",
      repeat: false,
      volume: volume,
      localization: {
        rewind: "Voltar 10s",
        forward: "Avançar 10s",
        fullscreen: "Tela Cheia",
        hd: "Qualidade"
      }
    });

    function millisToMinutesAndSeconds(millis) {
      let minutes = Math.floor(millis / 60);
      let seconds = Math.floor(millis % 60);
      return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }

    jwplayer("player").on('ready', function () {
      jwplayer("player").setPlaybackRate(1);
    });

    jwplayer("player").on('firstFrame', function () {
      if (currentPosition > 0) {
        jwplayer("player").pause();
        const box = `
          <div class="_4continuar">
            <p>Aparentemente você já esteve assistindo isto, e você parou em ${millisToMinutesAndSeconds(currentPosition)}. Deseja continuar de onde parou?</p>
            <button class="bt" data-time="${currentPosition}">Sim</button>
            <button class="bt" data-time="0">Não</button>
          </div>`;
        $("#continue-box").html(box).addClass("active");
      }
    });

    $(document).on('click', '._4continuar .bt', function () {
      const time = parseFloat($(this).data("time"));
      $("#continue-box").removeClass("active").empty();
      jwplayer("player").seek(time);
      jwplayer("player").play();
    });

    jwplayer("player").on('time', function () {
      const pos = jwplayer("player").getPosition();
      if (!isNaN(pos)) {
        localStorage.setItem(ID, pos);
      }
    });

    // Suporte a autoplay via postMessage
    window.addEventListener("message", function (e) {
      if (e.data === 'autoplay') {
        jwplayer("player").play();
      }
    });
  }
</script>
</body>
</html>
