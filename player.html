<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>JWPlayer Dinâmico</title>
  <script src="//ssl.p.jwpcdn.com/player/v/8.36.4/jwplayer.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    jwplayer.key = 'eNFaXCjyURVoCCGiHp7HTQ3hDhE/AfL0g8VE1fRbL84=';
  </script>
  <style>
    #player {
      height: 450px;
      width: 800px;
      max-width: 100%;
    }

    ._4continuar {
      background: #292929;
      color: #fff;
      padding: 18px;
      margin: 10px;
      border-radius: 4px;
    }

    ._4continuar bt {
      display: inline-block;
      margin: 5px;
      padding: 10px;
      background: #383838;
      border-radius: 4px;
      cursor: pointer;
    }

    ._4continuar bt:hover {
      background: #504f4f;
    }
  </style>
</head>
<body>
  <div id="player">Carregando o player...</div>

  <script>
    function getVideoUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get("video");
    }

    const videoUrl = getVideoUrl();

    if (videoUrl) {
      const player = jwplayer("player").setup({
        sources: [{
          file: videoUrl,
          label: "1080p"
        }],
        width: "100%",
        aspectratio: "16:9",
        controls: true,
        autostart: false,
        displaytitle: true,
        playbackRateControls: true,
        volume: 100,
        repeat: false,
        preload: "none",
        localization: {
          fullscreen: "Tela Cheia",
          hd: "Qualidade",
          copied: "Copiado",
          playbackRates: "Velocidade da reprodução",
          videoInfo: "Sobre este vídeo",
          rewind: "Voltar 10s",
          forward: "Avançar 10s",
          settings: "Configurações",
          loadingAd: "Carregando anúncio"
        },
        aboutlink: 'https://webmods.com.br/',
      });

      // Botão de download
      player.addButton(
        '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21"><path fill="#f5f5f5" d="M10.902 12.953c-.496.438-1.289.438-1.805 0L4.637 8.949a1 1 0 111.8-1.594l2.125 1.906V1.406a1 1 0 112 0v7.741l2.125-1.906a1 1 0 011.8 1.594zM18.625 20.977H1.418A1.42 1.42 0 010 19.594V14a1.42 1.42 0 012.832 0v4.191h14.313V14a1.42 1.42 0 012.836 0v5.594a1.42 1.42 0 01-1.356 1.383z"/></svg>',
        "Baixar",
        function () {
          window.location.href = videoUrl;
        },
        "download"
      );

      // Botão para pular 85s (pular abertura/ending)
      player.addButton(
        "https://www.anitube.vip/img/skip.svg?version=0.0.1",
        "Pular OP/ED",
        function () {
          player.seek(player.getPosition() + 85);
        },
        "pula-opening"
      );

      // Botão avançar 10s
      player.addButton(
        '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240"><path d="M113.2,131.078a21.589,21.589,0,0,0-17.7-10.6,21.589,21.589,0,0,0-17.7,10.6a44.769,44.769,0,0,0,0,46.3,21.589,21.589,0,0,0,17.7,10.6,21.589,21.589,0,0,0,17.7-10.6,44.769,44.769,0,0,0,0-46.3Z"/></svg>',
        "Avançar 10s",
        function () {
          player.seek(player.getPosition() + 10);
        },
        "forward"
      );

      // Botão voltar 10s
      player.addButton(
        '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240"><path d="M95.5,178.278c-7.8,0-14.4-11-14.4-24.1s6.6-24.1,14.4-24.1,14.4,11,14.4,24.1S103.4,178.278,95.5,178.278Z"/></svg>',
        "Voltar 10s",
        function () {
          const time = Math.max(player.getPosition() - 10, 0);
          player.seek(time);
        },
        "rewind"
      );

      // Recurso de continuar de onde parou
      const ID = videoUrl;
      const playID = 'player';
      const currentPosition = localStorage.getItem("w" + ID);
      let lock = false;

      player.on('play', function () {
        if (!lock && currentPosition > 0) {
          player.pause();
          const box = `<div class="_4continuar"><p>Você parou em ${millisToMinutesAndSeconds(currentPosition)}. Deseja continuar?</p><bt data-time="${currentPosition}">Sim</bt><bt data-time="0">Não</bt></div>`;
          $("#" + playID).append(box);
        }
        lock = true;
      });

      $(document).on("click", "._4continuar > bt", function () {
        const time = $(this).attr("data-time");
        $("._4continuar").remove();
        player.seek(time);
        player.play();
      });

      function millisToMinutesAndSeconds(seconds) {
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60).toString().padStart(2, '0');
        return `${min}:${sec}`;
      }

      player.on("play", function () {
        function saveProgress() {
          localStorage.setItem("w" + ID, player.getPosition());
          setTimeout(saveProgress, 1000);
        }
        saveProgress();
      });
    } else {
      document.getElementById("player").innerText = "Nenhum vídeo especificado.";
    }
  </script>
</body>
</html>
