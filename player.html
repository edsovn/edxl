<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player</title>
<script src="https://ssl.p.jwpcdn.com/player/v/8.36.4/jwplayer.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #000;
  }
  #player {
    width: 100%;
    height: 100%;
    min-height: 360px;
  }

    .jw-reset .jw-button-container div.jw-icon-rewind {
      display: none;
    }

  
#continue-box {
  position: absolute;
  top: 20px;
  left: 20px;
  right: 20px;
  z-index: 9999;
  pointer-events: auto;
}

  ._4continuar {
    color: #fff;
    min-height: 6em;
    padding: 18px;
    margin: 10px;
    width: calc(100% - 20px);
    text-align: left;
    border-radius: 4px;
    background: #292929;
  }
  ._4continuar .bt {
    padding: 10px;
    background: #383838;
    display: inline-block;
    margin: 5px;
    border-radius: 4px;
    cursor: pointer;
  }
  ._4continuar .bt:hover {
    background: #504f4f;
  }
</style>
<script>
  jwplayer.key = 'XsK+VuloUK5YB+O7Z6I3aD4DP42TKEoQd2MLvA==';

  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  const VIDEO_URL = getQueryParam("video");
  const DOWNLOAD_URL = VIDEO_URL ? VIDEO_URL.replace("raw=1", "dl=1") : "";
</script>
</head>
<body>
<div id="continue-box"></div>
<div id="player">Carregando o player...</div>
<script>
  if (!VIDEO_URL) {
    document.getElementById("player").innerHTML = '<p style="color:white;padding:20px">URL do vídeo não fornecida.</p>';
  } else {
    const videoName = new URL(VIDEO_URL).pathname.split('/').pop();
    const ID = 'video_' + videoName;
    let currentPosition = parseFloat(localStorage.getItem(ID));
    console.log("Progresso salvo encontrado:", currentPosition);

    jwplayer("player").setup({
      file: VIDEO_URL,
      width: "100%",
      height: "100%",
      controls: true,
      autostart: false,
      playbackRateControls: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2],
      displaytitle: true,
      preload: "none",
      repeat: false,
      volume: 100,
      localization: {
        rewind: "Voltar 10s",
        forward: "Avançar 10s",
        fullscreen: "Tela Cheia",
        hd: "Qualidade"
      }
    });

    
jwplayer("player").on('ready', function () {
  jwplayer("player").setPlaybackRate(1);

  setTimeout(() => {
    jwplayer("player").addButton(
      "https://cdn-icons-png.flaticon.com/512/727/727245.png",
      "Pular OP/ED",
      function () {
        jwplayer("player").seek(jwplayer("player").getPosition() + 82);
      },
      "skip"
    );
    jwplayer("player").addButton(
      "https://cdn-icons-png.flaticon.com/512/545/545682.png",
      "Avançar 10s",
      function () {
        const time = jwplayer("player").getPosition() + 10;
        jwplayer("player").seek(time);
      },
      "forward"
    );
    jwplayer("player").addButton(
      "https://cdn-icons-png.flaticon.com/512/545/545680.png",
      "Voltar 10s",
      function () {
        const time = jwplayer("player").getPosition() - 10;
        jwplayer("player").seek(time > 0 ? time : 0);
      },
      "rewind"
    );
    jwplayer("player").addButton(
      "https://cdn-icons-png.flaticon.com/512/709/709699.png",
      "Baixar",
      function () {
        window.open(DOWNLOAD_URL, "_blank");
      },
      "download"
    );
  }, 500);
});


jwplayer("player").on('firstFrame', function () {
      if (currentPosition && currentPosition > 0) {
        jwplayer("player").pause();
        const box = `
          <div class="_4continuar">
            <p>Você parou em ${millisToMinutesAndSeconds(currentPosition)}. Deseja continuar?</p>
            <button class="bt" data-time="${currentPosition}">Sim</button>
            <button class="bt" data-time="0">Não</button>
          </div>`;
        $("#continue-box").html(box);
      }

      jwplayer("player").on('ready', function () {
      setTimeout(() => {
        jwplayer("player").addButton(
          "https://cdn-icons-png.flaticon.com/512/189/189792.png",
          "Pular OP/ED",
          function () {
            jwplayer("player").seek(jwplayer("player").getPosition() + 82);
          },
          "skip"
        );

        jwplayer("player").addButton(
          "https://cdn-icons-png.flaticon.com/512/271/271228.png",
          "Avançar 10s",
          function () {
            const time = jwplayer("player").getPosition() + 10;
            jwplayer("player").seek(time);
          },
          "forward"
        );

        jwplayer("player").addButton(
          "https://cdn-icons-png.flaticon.com/512/271/271220.png",
          "Voltar 10s",
          function () {
            const time = jwplayer("player").getPosition() - 10;
            jwplayer("player").seek(time > 0 ? time : 0);
          },
          "rewind"
        );

        jwplayer("player").addButton(
          "https://cdn-icons-png.flaticon.com/512/709/709586.png",
          "Baixar",
          function () {
            window.open(DOWNLOAD_URL, "_blank");
          },
          "download"
        );
            }, 500);
    });
    });

    $(document).on('click', '._4continuar .bt', function () {
      const time = parseFloat($(this).data("time"));
      $("._4continuar").remove();
      jwplayer("player").seek(time);
      jwplayer("player").play();
    });

    jwplayer("player").on('time', function () {
      const pos = jwplayer("player").getPosition();
      if (!isNaN(pos)) {
        localStorage.setItem(ID, pos);
        console.log("Salvando progresso:", pos);
      }
    });

    function millisToMinutesAndSeconds(time) {
      const min = Math.floor(time / 60);
      const sec = ("0" + Math.floor(time % 60)).slice(-2);
      return `${min}:${sec}`;
    }

    window.addEventListener("message", function (e) {
      if (e.data === 'autoplay') {
        jwplayer("player").play();
      }
    });
  }
</script>
</body>
</html>
